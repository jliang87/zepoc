<% provide :title, @user.name %>
<div class="row">
	<aside class="span4">
		<section>
			<h1>

            <% if !(@user.avatar_file_name.blank?) && !(@user.avatar_file_size == 0)  %>
		    	<a data-toggle="modal" href="#myModal"><%= image_tag @user.avatar.url(:thumb), style: "float:left; margin-right: 10px" %></a>
			<% else %>	
				    <% gravatar_id = Digest::MD5::hexdigest("jackliang1987@hotmail.com") %>
    				<% size = "90" %>
    				<% gravatar_url= "http://gravatar.com/avatar/#{gravatar_id}.png?s=#{size}" %>
		    	<a data-toggle="modal" href="#myModal"><%= image_tag(gravatar_url, class:"gravatar")%></a>
			<% end %>

			<%= @user.name %>

              <div class="modal hide" id="myModal">
			  <div class="modal-header">
			    <button type="button" class="close" data-dismiss="modal">X</button>
			    <h3><%= @user.name %></h3>
			  </div>
			  <div class="modal-body">
                <div id="outer">
                  <div class="jcExample">
                    <div class="article">
			  	          <% if !(@user.avatar_file_name.blank?) && !(@user.avatar_file_size == 0) %>
                          <%= stylesheet_link_tag "jquery.Jcrop" %>
                          <%= javascript_include_tag "jquery.Jcrop.min" %>
                          <script type="text/javascript" charset="utf-8">
                              $(function() {
                                  $('#cropbox').Jcrop({
                                      onChange: update_crop,
                                      onSelect: update_crop,
                                      setSelect: [0, 0, 500, 500],
                                      aspectRatio: 1
                                  });
                              });

                              function update_crop(coords) {
                                  var rx = 100/coords.w;
                                  var ry = 100/coords.h;
                                  $('#preview').css({
                                      width: Math.round(rx * <%= @user.avatar_geometry(:medium).width %>) + 'px',
                                      height: Math.round(ry * <%= @user.avatar_geometry(:medium).height %>) + 'px',
                                      marginLeft: '-' + Math.round(rx * coords.x) + 'px',
                                      marginTop: '-' + Math.round(ry * coords.y) + 'px'
                                  });
                                  var ratio = <%= @user.avatar_geometry(:original).width %> / <%= @user.avatar_geometry(:medium).width %>;
                                  $("#crop_x").val(Math.round(coords.x * ratio));
                                  $("#crop_y").val(Math.round(coords.y * ratio));
                                  $("#crop_w").val(Math.round(coords.w * ratio));
                                  $("#crop_h").val(Math.round(coords.h * ratio));
                              }
                          </script>
                    <table>
                      <tr>
                        <td>
                          <%= image_tag @user.avatar.url(:medium), id: "cropbox" %>
                        </td>
                        <td>
                          <div style="width:100px;height:100px;overflow:hidden;">
                            <%= image_tag @user.avatar.url(:medium), id: "preview", style: "max-width: none" %>
                          </div>
                        </td>
                      </tr>
                    </table>
			    <% else %>
			    	<%= image_tag gravatar_url, class:"gravatar" %>
			    <% end %>
                    </div>
                  </div>
                </div>

			  </div>
			  <div class="modal-footer">
			    <!-- <a href="#" class="btn" data-dismiss="modal">Close</a> -->
			    <!-- <a href="#" class="btn btn-primary">Save changes</a> -->
			  </div>
			</div>
			
			</h1>
		</section>
	</aside>	
</div>
